var MAPS=function(){"use strict";var a,b="/images/busIcon.png",c=[],d={zoom:16,center:new google.maps.LatLng(51.508738,-.127906)},e=new google.maps.Map(document.getElementById("main-map"),d);google.maps.event.addListener(e,"dragend",function(){f()}),google.maps.event.addListener(e,"bounds_changed",function(){l()}),google.maps.event.addListener(e,"zoom_changed",function(){l(),f()}),google.maps.event.addListenerOnce(e,"idle",function(){f()});var f=function(){var b=a.getNorthEast().toUrlValue(),c=a.getSouthWest().toUrlValue();k(),$.ajax({url:"http://digitaslbi-id-test.herokuapp.com/bus-stops",data:{northEast:b,southWest:c},dataType:"jsonp",success:function(a){i(a.markers)}})},g=function(a){$.ajax({url:"http://digitaslbi-id-test.herokuapp.com/bus-stops/"+a.id,dataType:"jsonp",success:function(b){h(b.arrivals,a)}})},h=function(a,b){var c="",d="";$("#arrivals-container").removeClass("endAnimate").addClass("beginAnimate"),d=null!==b.stopIndicator?b.name+" ("+b.stopIndicator+")":b.name,$("#bus-stop-name").empty().append(d);for(var e in a)c+='<li><span class="first-item">'+a[e].routeName+'</span><span class="second-item">to '+a[e].destination+'</span><span class="third-item">'+a[e].estimatedWait+"</span></li>";""===c&&(c='<li><span class="no-arrivals">There are no upcoming arrivals</span></li>'),$("#bus-arrivals").empty().append(c),$("#arrivals-container").removeClass("beginAnimate").addClass("endAnimate")},i=function(a){for(var d in a){var f=new google.maps.Marker({position:{lat:a[d].lat,lng:a[d].lng},map:e,details:a[d],icon:b,animation:google.maps.Animation.DROP}),h="";h=null!==a[d].stopIndicator?"<h4>"+a[d].name+" ("+a[d].stopIndicator+")</h4>":"<h4>"+a[d].name+"</h4>",f.info=new google.maps.InfoWindow({content:h}),google.maps.event.addListener(f.info,"closeclick",function(){j()}),google.maps.event.addListener(f,"click",function(){g(this.details),j(),this.info.open(e,this),this.setAnimation(null!==this.getAnimation()?null:google.maps.Animation.BOUNCE)}),c.push(f)}},j=function(){for(var a in c)null!==c[a].getAnimation()&&c[a].setAnimation(null),c[a].info.close()},k=function(){for(var a in c)c[a].setMap(null);c=[]},l=function(){a=e.getBounds()}}();